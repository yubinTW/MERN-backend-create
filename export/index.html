<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">

	<title>MERN Backend</title>

	<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
	<meta name="author" content="Hakim El Hattab">

	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="libs/reveal.js/4.1.3/reset.css">
	<link rel="stylesheet" href="libs/reveal.js/4.1.3/reveal.css">

	
	
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

	  <!-- highlight Theme -->
  	
	  <link rel="stylesheet" href="libs/highlight.js/11.3.1/styles/monokai.min.css">
	
	
		
	<link rel="stylesheet" href="libs/reveal.js/4.1.3/plugin/chalkboard/style.css">
	
	
	
		<link rel="stylesheet" href="libs/reveal.js/4.1.3/plugin/customcontrols/style.css">
	
	<link rel="stylesheet" href="libs/styles/tasklist.css">



  <!-- Revealjs Theme -->
  
  	<link rel="stylesheet" href="libs/reveal.js/4.1.3/theme/night.css" id="theme">
  
  


  <!-- Revealjs Theme -->
  

 
</head>

<body>
  


  <div class="reveal">

    <!-- Any section element inside of this container is displayed as a slide -->
    <div class="slides">

      


    
        <section >
            
            <h3>MERN Backend Practice</h3>
<style>
pre {
  background: #303030;
  padding: 10px 16px;
  border-radius: 0.3em;
  counter-reset: line;
}
pre code[class*="="] .line {
  display: block;
  line-height: 1.8rem;
  font-size: 1em;
}
pre code[class*="="] .line:before {
  counter-increment: line;
  content: counter(line);
  display: inline-block;
  border-right: 3px solid #6ce26c !important;
  padding: 0 .5em;
  margin-right: .5em;
  color: #afafaf !important;
  width: 24px;
  text-align: right;
}

.reveal .slides > section > section {
  text-align:left; 
}

h1,h2,h3,h4 {
  text-align: center
}

p {
  text-align: center;
}

.present img {
    max-height: 65vh;
}
</style>
<script>

    window.onload = () => setTimeout(setLineNumber, 10)
    
    const setLineNumber = () => {
        const codeBlocks = document.querySelectorAll('pre code[class*="="]')
        codeBlocks.forEach(code => {
            const addLineSpan = code.innerHTML.trim().replaceAll('\n','</span><span class="line">')
            code.innerHTML = `<span class="line">${addLineSpan}</span>`    
        })
    }
    
</script>

            </section>
    



    
        <section >
            
            <p>Yubin, Hsu</p>
<p>TSID / NTAD</p>
<p><a href="mailto:ybhsu@tsmc.com">ybhsu@tsmc.com</a></p>

            </section>
    



    
        <section >
            
            <h3>Outline</h3>
<ul>
<li>Create the backend project</li>
<li>MongoDB support</li>
<li>Implement the API</li>
<li>Define API routes as a plugin</li>
<li>Define response schema</li>
<li>Jest</li>
<li>Serve frontend code</li>
</ul>

            </section>
    



    
    <section>
        <section >
            <h3>Create the backend project</h3>

            </section>
        
            <section >
                <ul>
<li>create project folder</li>
</ul>
<pre><code class="language-bash=">mkdir myMernProject
cd myMernProject
</code></pre>
<ul>
<li>create backend project</li>
</ul>
<pre><code class="language-bash=">mkdir backend
cd backend
npm init
</code></pre>

            </section>
        
            <section >
                <ul>
<li>Install dependencies of backend project</li>
</ul>
<pre><code class="language-bash=">npm i fastify pino-pretty dotenv
npm i -D typescript @types/node
npx tsc --init
</code></pre>

            </section>
        
            <section >
                <p>edit backend/tsconfig.json</p>
<pre><code class="language-json=">&quot;include&quot;: [&quot;src/**/*.ts&quot;],
&quot;exclude&quot;: [&quot;node_modules&quot;],

&quot;compilerOptions&quot;: {
  &quot;outDir&quot;: &quot;./out&quot;,
  &quot;rootDir&quot;: &quot;./src&quot;,
}
</code></pre>

            </section>
        
            <section >
                <p>create backend/.env</p>
<pre><code class="language-plaintext">FASTIFY_PORT=8888
</code></pre>

            </section>
        
            <section >
                <p>create backend/src/server.ts</p>
<pre><code class="language-typescript=">import fastify, { FastifyInstance } from &quot;fastify&quot;

const server: FastifyInstance = fastify({
    logger: {
        prettyPrint: true
    }
})

const startFastify: (port: number) =&gt; FastifyInstance = (port) =&gt; {
    const listenAddress = '0.0.0.0'

    server.listen(port, listenAddress, (error, _) =&gt; {
        if (error) {
            console.error(error)
        }
    })

    server.get('/ping', async (request, reply) =&gt; {
        return reply.status(200).send({ msg: 'pong' })
    })

    return server
}

export { startFastify }
</code></pre>

            </section>
        
            <section >
                <p>create backend/src/index.ts</p>
<pre><code class="language-typescript=">import { startFastify } from './server'
import * as dotenv from 'dotenv'

dotenv.config()
const port = process.env.FASTIFY_PORT || '8888'

// Start your server
const server = startFastify(parseInt(port))

export { server }
</code></pre>

            </section>
        
            <section >
                <p>build and run</p>
<ul>
<li>build with tsc</li>
</ul>
<pre><code>tsc
</code></pre>
<ul>
<li>run with node</li>
</ul>
<pre><code>node out/index.js
</code></pre>

            </section>
        
            <section >
                <p>Define custom npm scripts</p>
<ul>
<li>edit backend/package.json</li>
</ul>
<pre><code class="language-json=">&quot;scripts&quot;: {
  &quot;build&quot;: &quot;tsc&quot;,
  &quot;start&quot;: &quot;node out/index.js&quot;
},
</code></pre>

            </section>
        
            <section >
                <p>Use custom npm script</p>
<pre><code class="language-plaintext=">npm run build
npm run start
</code></pre>

            </section>
        

    </section>
    



    
        <section >
            
            <p>visit the endpoint</p>
<p><img src="res/2021-08-13-05-10-53.png" alt=""></p>

            </section>
    



    
    <section>
        <section >
            <p>API client</p>
<ul>
<li>Postman</li>
<li>curl</li>
<li>Thunder Client (vscode extension)</li>
<li>REST Client (vscode extension)</li>
</ul>

            </section>
        
            <section >
                <p>Thunder Client</p>
<p><img src="res/2021-08-13-05-12-51.png" alt=""></p>

            </section>
        
            <section >
                <p>Send request by Thunder Client</p>
<p><img src="res/2021-08-13-05-12-04.png" alt=""></p>

            </section>
        
            <section >
                <p>REST Client</p>
<p><img src="res/2021-11-11-22-48-21.png" alt=""></p>

            </section>
        
            <section >
                <p>Send request by REST Client</p>
<p>create a .http file, send request</p>
<p><img src="res/2021-11-11-22-55-31.png" alt=""></p>

            </section>
        

    </section>
    



    
    <section>
        <section >
            <p>create <code>.gitignore</code></p>
<pre><code class="language-plaintext=">node_modules
out
.env
</code></pre>

            </section>
        
            <section >
                <p>get more .gitignore example</p>
<p><a href="https://github.com/github/gitignore">https://github.com/github/gitignore</a></p>

            </section>
        

    </section>
    



    
    <section>
        <section >
            <p>Add mongo support</p>

            </section>
        
            <section >
                <p>Start a mongodb server</p>
<ul>
<li>using docker</li>
</ul>
<pre><code>docker run -d -p 27017:27017 mongo
</code></pre>
<ul>
<li>or binary</li>
</ul>
<pre><code>./mongod.exe
</code></pre>

            </section>
        
            <section >
                <p>Install mongoose</p>
<pre><code>npm i mongoose
</code></pre>

            </section>
        
            <section >
                <p>MongoDB Connection String</p>
<pre><code>mongodb://[username:password@]host1[:port1][,...hostN[:portN]][/[defaultauthdb][?options]]
</code></pre>
<p><a href="https://docs.mongodb.com/manual/reference/connection-string/">https://docs.mongodb.com/manual/reference/connection-string/</a></p>

            </section>
        
            <section >
                <p>Connection String Example</p>
<pre><code>mongodb://mongodb0.example.com:27017
</code></pre>
<pre><code>mongodb://myDBReader:D1fficultP%40ssw0rd@mongodb0.example.com:27017/?authSource=admin
</code></pre>

            </section>
        
            <section >
                <p>Add env variables in backend/.env</p>
<pre><code>MONGO_CONNECTION_STRING=mongodb://localhost:27017/myMERN
</code></pre>

            </section>
        
            <section >
                <p>Create backend/src/plugins/mongoose.ts</p>
<pre><code class="language-typescript=">import mongoose from 'mongoose'

const establishConnection = () =&gt; {
    const connectionString = process.env.MONGO_CONNECTION_STRING || 'mongodb://localhost:27017/myProject'
    mongoose.connect(connectionString, error =&gt; {
        if (error) {
            console.log(`Error in DB connection: ${error}`)
        } else {
            console.log(`MongoDB connection successful`)
        }
    })
}

export { establishConnection }
</code></pre>

            </section>
        
            <section >
                <p>Edit backend/src/server.ts</p>
<pre><code class="language-typescript=">import { establishConnection } from './plugins/mongoose'

// ...

    server.listen(port, listenAddress, (error, _) =&gt; {
        if (error) {
            console.error(error)
        }
        establishConnection()
    })

// ...
</code></pre>

            </section>
        
            <section >
                <p>Start server</p>
<p><img src="res/2021-08-17-03-19-36.png" alt=""></p>
<p><code>MongoDB connection successful</code></p>

            </section>
        

    </section>
    



    
    <section>
        <section >
            <p>Add mongo schema</p>
<p><a href="https://mongoosejs.com/docs/typescript.html">https://mongoosejs.com/docs/typescript.html</a></p>

            </section>
        
            <section >
                <p>Define interface</p>
<p>create backend/src/types/cat.ts</p>
<pre><code class="language-typescript=">interface ICat {
    name: string
    weight: number
}

export { ICat }
</code></pre>

            </section>
        
            <section >
                <p>Add mongo schema</p>
<p>create backend/src/models/cat.ts</p>
<pre><code class="language-typescript=">import { model, Schema } from 'mongoose'
import { ICat } from '../types/cat'

const catSchema: Schema = new Schema(
    {
        name: {
            type: String,
            required: true
        },
        weight: {
            type: Number,
            default: 0
        }
    },
    {
        timestamps: true
    }
)

export default model&lt;ICat&gt;('Cat', catSchema)
</code></pre>

            </section>
        
            <section >
                <p><a href="https://mongoosejs.com/docs/guide.html">https://mongoosejs.com/docs/guide.html</a>
<a href="https://mongoosejs.com/docs/schematypes.html">https://mongoosejs.com/docs/schematypes.html</a></p>

            </section>
        

    </section>
    



    
    <section>
        <section >
            <p>Get Cats</p>

            </section>
        
            <section >
                <p>Add Cat Repo</p>
<p>create backend/src/repo/cat-repo.ts</p>
<pre><code class="language-typescript=">import { ICat } from './../types/cat'
import Cat from './../models/cat'

interface CatRepo {
  getCats(): Promise&lt;Array&lt;ICat&gt;&gt;
}

class CatRepoImpl implements CatRepo {
  private constructor() {}

  static of(): CatRepoImpl {
    return new CatRepoImpl()
  }

  async getCats(): Promise&lt;Array&lt;ICat&gt;&gt; {
    return Cat.find()
  }

}

export { CatRepoImpl }
</code></pre>

            </section>
        
            <section >
                <p>Add API endpoint</p>

            </section>
        
            <section >
                <p>edit backend/src/server.ts</p>
<ul>
<li>GET /cats</li>
</ul>
<pre><code class="language-typescript=">import { CatRepoImpl } from './repo/cat-repo'
// ...
server.get('/cats', async (request, reply) =&gt; {
  const catRepo = CatRepoImpl.of()
  try {
    const cats = await catRepo.getCats()
    return reply.status(200).send({ cats })
  } catch (error) {
    return reply.status(500).send({ msg: `Internal Server Error: ${error}` })
  }
})
</code></pre>

            </section>
        
            <section >
                <ul>
<li>send GET request (by Thunder Client)</li>
</ul>
<p><img src="res/2021-08-17-04-53-04.png" alt=""></p>

            </section>
        
            <section >
                <ul>
<li>send GET request (by REST Client)</li>
</ul>
<p><img src="res/2021-11-16-01-11-06.png" alt=""></p>

            </section>
        

    </section>
    



    
    <section>
        <section >
            <p>Add Cat</p>

            </section>
        
            <section >
                <p>edit backend/src/repo/cat-repo.ts</p>
<pre><code class="language-typescript=">import { ICat } from './../types/cat'
import Cat from './../models/cat'

interface CatRepo {
  getCats(): Promise&lt;Array&lt;ICat&gt;&gt;
  addCat(catBody: ICat): Promise&lt;ICat&gt;
}

class CatRepoImpl implements CatRepo {
  private constructor() {}

  static of(): CatRepoImpl {
    return new CatRepoImpl()
  }

  async getCats(): Promise&lt;Array&lt;ICat&gt;&gt; {
    return Cat.find()
  }

  async addCat(catBody: ICat): Promise&lt;ICat&gt; {
    return Cat.create(catBody)
  }

}

export { CatRepoImpl }
</code></pre>

            </section>
        
            <section >
                <p>Add API endpoint</p>

            </section>
        
            <section >
                <p>edit backend/src/server.ts</p>
<ul>
<li>POST /cats</li>
</ul>
<pre><code class="language-typescript=">import { ICat } from './types/cat'
// ...
server.post('/cats', async (request, reply) =&gt; {
  const catRepo = CatRepoImpl.of()
  try {
    const catBody = request.body as ICat
    const cat = await catRepo.addCat(catBody)
    return reply.status(201).send({ cat })
  } catch (error) {
    return reply.status(500).send({ msg: `Internal Server Error: ${error}` })
  }
})
</code></pre>

            </section>
        
            <section >
                <p>Send POST request (by Thunder Client)</p>
<p><img src="res/2021-08-17-05-06-19.png" alt=""></p>

            </section>
        
            <section >
                <p>Get /cats again</p>
<p><img src="res/2021-08-17-05-09-43.png" alt=""></p>

            </section>
        
            <section >
                <p>Send POST request (by REST Client)</p>
<p><img src="res/2021-11-16-01-21-24.png" alt=""></p>

            </section>
        
            <section >
                <p>Get /cats again</p>
<p><img src="res/2021-11-16-01-22-32.png" alt=""></p>

            </section>
        

    </section>
    



    
    <section>
        <section >
            <p>Add id and remove __v for the mongoose schema</p>

            </section>
        
            <section >
                <p>edit backend/src/models/cat.ts</p>
<pre><code class="language-typescript=">catSchema.set('toJSON', {
    virtuals: true,
    versionKey: false,
})
</code></pre>
<p><a href="https://mongoosejs.com/docs/tutorials/virtuals.html#virtuals-in-json">https://mongoosejs.com/docs/tutorials/virtuals.html#virtuals-in-json</a></p>

            </section>
        
            <section >
                <p>Get /cats again</p>
<p><img src="res/2021-11-16-01-36-47.png" alt=""></p>

            </section>
        

    </section>
    



    
    <section>
        <section >
            <h4>Rebuild automatically when the code is changed</h4>

            </section>
        
            <section >
                <ul>
<li>install concurrently and nodemon</li>
</ul>
<pre><code class="language-planetext">npm i -D concurrently nodemon
</code></pre>
<ul>
<li>add the script in package.json</li>
</ul>
<pre><code class="language-planttext">&quot;dev&quot;: &quot;concurrently \&quot;tsc -w \&quot; \&quot;nodemon out/index.js\&quot;&quot;
</code></pre>
<ul>
<li>run the script</li>
</ul>
<pre><code>npm run dev
</code></pre>

            </section>
        

    </section>
    



    
    <section>
        <section >
            <h3>prettier</h3>

            </section>
        
            <section >
                <p>install prettier</p>
<pre><code>npm i -D prettier
</code></pre>

            </section>
        
            <section >
                <p>add backend/.prettierrc</p>
<pre><code class="language-planttext">{
  &quot;semi&quot;: false,
  &quot;singleQuote&quot;: true,
  &quot;printWidth&quot;: 120,
  &quot;trailingComma&quot;: &quot;none&quot;,
  &quot;arrowParens&quot;: &quot;always&quot;
}
</code></pre>
<p>ref: <a href="https://prettier.io/docs/en/options.html">https://prettier.io/docs/en/options.html</a></p>

            </section>
        
            <section >
                <ul>
<li>add the script in package.json</li>
</ul>
<pre><code class="language-planttext">&quot;fix-prettier&quot;: &quot;prettier --write \&quot;./{src,test}/**/*.ts\&quot;&quot;
</code></pre>
<ul>
<li>format code by prettier</li>
</ul>
<pre><code>npm run fix-prettier
</code></pre>

            </section>
        

    </section>
    



    
    <section>
        <section >
            <h4>Define API routes as a plugin</h4>
<p>ref: <a href="https://www.fastify.io/docs/latest/Reference/Plugins/#create-a-plugin">https://www.fastify.io/docs/latest/Reference/Plugins/#create-a-plugin</a></p>

            </section>
        
            <section >
                <p>create backend/src/routes/cat.ts</p>
<p>move API from server.ts to this file</p>
<pre><code class="language-typescript=">import { FastifyInstance, RouteShorthandOptions, FastifyReply } from 'fastify'
import { ICat } from '../types/cat'
import { CatRepoImpl } from '../repo/cat-repo'

const CatRouter = (server: FastifyInstance, opts: RouteShorthandOptions, done: (error?: Error) =&gt; void) =&gt; {

    server.get('/cats', async (request, reply) =&gt; {
        const catRepo = CatRepoImpl.of()
        try {
            const cats = await catRepo.getCats()
            return reply.status(200).send({ cats })
        } catch (error) {
            return reply.status(500).send({ msg: `Internal Server Error: ${error}` })
        }
    })

    server.post&lt;{ Body: ICat }&gt;('/cats', async (request, reply) =&gt; {
        const catRepo = CatRepoImpl.of()
        try {
            const catBody = request.body
            const cat = await catRepo.addCat(catBody)
            return reply.status(201).send({ cat })
        } catch (error) {
            return reply.status(500).send({ msg: `Internal Server Error: ${error}` })
        }
    })


    done()
}

export { CatRouter }

</code></pre>

            </section>
        
            <section >
                <h4>register CatRouter</h4>
<p>edit backend/src/server.ts</p>
<pre><code class="language-typescript">server.register(CatRouter, { prefix: '/v1' })
</code></pre>

            </section>
        
            <section >
                <p><img src="res/2021-08-17-05-36-46.png" alt=""></p>

            </section>
        

    </section>
    



    
        <section >
            
            <p>DIY: implement update and delete API</p>
<ul>
<li><a href="https://www.fastify.io/docs/v1.14.x/TypeScript/">https://www.fastify.io/docs/v1.14.x/TypeScript/</a></li>
<li><a href="https://mongoosejs.com/docs/guide.html">https://mongoosejs.com/docs/guide.html</a></li>
</ul>

            </section>
    



    
    <section>
        <section >
            <h3>url parameter</h3>

            </section>
        
            <section >
                <p>PUT /cats/:id</p>

            </section>
        
            <section >
                <pre><code class="language-typescript=">server.put('/cats/:id', async (request, reply) =&gt; {
  const id = request.params.id
  // ...
})
</code></pre>
<p><img src="res/2021-08-17-07-27-26.png" alt=""></p>

            </section>
        
            <section >
                <pre><code class="language-typescript=">interface IdParams {
    id: string
}
server.put&lt;{ Params: IdParams }&gt;('/cats/:id', async (request, reply) =&gt; {
  const id = request.params.id
  // ...
})
</code></pre>
<p>ref: <a href="https://www.fastify.io/docs/v1.14.x/TypeScript/">https://www.fastify.io/docs/v1.14.x/TypeScript/</a></p>

            </section>
        

    </section>
    



    
    <section>
        <section >
            <p>Update Cat</p>

            </section>
        
            <section >
                <p>edit backend/src/repo/cat-repo.ts</p>
<pre><code class="language-typescript=">async updateCat(id: String, catBody: ICat): Promise&lt;ICat | null&gt; {
  return Cat.findByIdAndUpdate(id, catBody, { new: true })
}
</code></pre>
<p>ref: <a href="https://mongoosejs.com/docs/api.html#model_Model.findByIdAndUpdate">https://mongoosejs.com/docs/api.html#model_Model.findByIdAndUpdate</a></p>

            </section>
        
            <section >
                <p>Add API endpoint</p>
<p>PUT /cats/:id</p>
<pre><code class="language-typescript=">server.put&lt;{ Params: IdParams; Body: ICat }&gt;('/cats/:id', async (request, reply) =&gt; {
  const catRepo = CatRepoImpl.of()
  try {
    const catBody = request.body
    const id = request.params.id
    const cat = await catRepo.updateCat(id, catBody)
    return reply.status(200).send({ cat })
  } catch (error) {
    return reply.status(500).send({ msg: error })
  }
})
</code></pre>

            </section>
        
            <section >
                <p>if id not found</p>
<pre><code class="language-typescript=">const cat = await catRepo.updateCat(id, catBody)
if (cat) {
    return reply.status(200).send({ cat })
} else {
    return reply.status(404).send({msg: `Cat #${id} Not Found`})
}
</code></pre>

            </section>
        
            <section >
                <p>if id is invalid</p>
<pre><code class="language-typescript=">import { Types } from 'mongoose'

const id = request.params.id
if (!Types.ObjectId.isValid(id)) {
    return reply.status(400).send({msg: `Invalid id`})
}
</code></pre>

            </section>
        
            <section >
                <pre><code class="language-typescript=">server.put&lt;{ Params: IdParams; Body: ICat }&gt;('/cats/:id', async (request, reply) =&gt; {
  const catRepo = CatRepoImpl.of()
  try {
    const catBody = request.body
    const id = request.params.id
    if (!Types.ObjectId.isValid(id)) {
        return reply.status(400).send({msg: `Invalid id`})
    }
    const cat = await catRepo.updateCat(id, catBody)
    if (cat) {
        return reply.status(200).send({ cat })
    } else {
        return reply.status(404).send({msg: `Cat #${id} Not Found`})
    }
  } catch (error) {
    return reply.status(500).send({ msg: error })
  }
})
</code></pre>

            </section>
        

    </section>
    



    
    <section>
        <section >
            <p>Delete Cat</p>

            </section>
        
            <section >
                <p>edit backend/src/repo/cat-repo.ts</p>
<pre><code class="language-typescript=">async deleteCat(id: string): Promise&lt;ICat | null&gt; {
  return Cat.findByIdAndDelete(id)
}
</code></pre>
<p>ref: <a href="https://mongoosejs.com/docs/api.html#model_Model.findByIdAndDelete">https://mongoosejs.com/docs/api.html#model_Model.findByIdAndDelete</a></p>

            </section>
        
            <section >
                <p>Add API endpoint</p>
<p>DELETE /cats/:id</p>
<pre><code class="language-typescript=">server.delete&lt;{ Params: IdParams }&gt;('/cats/:id', async (request, reply) =&gt; {
  const catRepo = CatRepoImpl.of()
  try {
    const id = request.params.id
    if (!Types.ObjectId.isValid(id)) {
      return reply.status(400).send({ msg: `Invalid id` })
    }
    const cat = await catRepo.deleteCat(id)
    if (cat) {
      return reply.status(204).send()
    } else {
      return reply.status(404).send({ msg: `Cat #${id} Not Found` })
    }
  } catch (error) {
    return reply.status(500).send({ msg: error })
  }
})
</code></pre>

            </section>
        

    </section>
    



    
        <section >
            
            <p>DIY: Implement get one cat by id</p>
<ul>
<li>GET /cats/:id</li>
</ul>

            </section>
    



    
    <section>
        <section >
            <h3>Define response schema</h3>

            </section>
        
            <section >
                <h4>typebox</h4>
<pre><code>npm i @sinclair/typebox
</code></pre>
<p>ref: <a href="https://github.com/sinclairzx81/typebox">https://github.com/sinclairzx81/typebox</a></p>

            </section>
        
            <section >
                <p>edit backend/src/routes/cat.ts</p>
<pre><code class="language-typescript=">import { Type, Static } from '@sinclair/typebox'
// ...
// in CatRouter
const CatsResponse = Type.Object({
  cats: Type.Array(
    Type.Object({
      id: Type.String(),
      name: Type.String(),
      weight: Type.Number()
    })
  )
})
type CatsResponse = Static&lt;typeof CatsResponse&gt;
opts = { ...opts, schema: { response: { 200: CatsResponse } } }

// put opts at the second parameter
server.get('/cats', opts, async (request, reply) =&gt; {
  const catRepo = CatRepoImpl.of()
  try {
    const cats = await catRepo.getCats()
    return reply.status(200).send({ cats })
  } catch (error) {
    return reply.status(500).send({ msg: 'Internal Server Error' })
  }
})
</code></pre>

            </section>
        
            <section >
                <p>Get the response schema as defined</p>
<p><img src="res/2021-11-16-01-58-23.png" alt=""></p>

            </section>
        
            <section >
                <p>difference schemas based on difference status code</p>
<pre><code class="language-typescript=">const CatsResponse = {
  cats: Type.Array(
    Type.Object({
      id: Type.String(),
      name: Type.String(),
      weight: Type.Number()
    })
  )
}
type CatsResponse = Static&lt;typeof CatsResponse&gt;

const CatResponse = {
  cat: Type.Object({
    id: Type.String(),
    name: Type.String(),
    weight: Type.Number()
  })
}
type CatResponse = Static&lt;typeof CatResponse&gt;

opts = { ...opts, schema: { response: { 200: CatsResponse, 201: CatResponse } } }

server.get('/cats', opts, async (request, reply) =&gt; {
  const catRepo = CatRepoImpl.of()
  try {
    const cats = await catRepo.getCats()
    return reply.status(200).send({ cats })
  } catch (error) {
    return reply.status(500).send({ msg: `Internal Server Error: ${error}` })
  }
})

server.post('/cats', opts, async (request, reply) =&gt; {
  const catRepo = CatRepoImpl.of()
  try {
    const catBody = request.body as ICat
    const cat = await catRepo.addCat(catBody)
    return reply.status(201).send({ cat })
  } catch (error) {
    return reply.status(500).send({ msg: `Internal Server Error: ${error}` })
  }
})
</code></pre>

            </section>
        

    </section>
    



    
    <section>
        <section >
            <h3>Jest</h3>

            </section>
        
            <section >
                <p>Jest</p>
<ul>
<li>JavaScript testing framework</li>
<li>Open Source lead by Facebook</li>
<li><a href="https://github.com/facebook/jest">https://github.com/facebook/jest</a></li>
<li><a href="https://jestjs.io/">https://jestjs.io/</a></li>
</ul>

            </section>
        
            <section >
                <p>Setup jest</p>
<pre><code>npm i -D jest ts-jest @types/jest
</code></pre>
<ul>
<li>jest - <strong>JavaScript testing framework</strong></li>
<li>ts-jest - <strong>TypeScript preprocessor for jest</strong></li>
<li>@types/jest - <strong>type definition for jest</strong></li>
</ul>

            </section>
        
            <section >
                <p>Jest config</p>
<p><a href="https://jestjs.io/docs/configuration">https://jestjs.io/docs/configuration</a></p>
<p>create <code>backend/jest.config.js</code></p>
<pre><code class="language-javascript">module.exports = {
  preset: &quot;ts-jest&quot;,
  transform: {
    &quot;^.+\\.(t|j)sx?$&quot;: &quot;ts-jest&quot;,
  },
  testEnvironment: &quot;node&quot;,
  moduleFileExtensions: [
    &quot;ts&quot;,
    &quot;tsx&quot;,
    &quot;js&quot;,
    &quot;jsx&quot;,
    &quot;json&quot;,
    &quot;node&quot;,
  ],
  testTimeout: 20000,
  testPathIgnorePatterns: [
    &quot;/node_modules/&quot;,
    &quot;/out/&quot;
  ]
}
</code></pre>

            </section>
        
            <section >
                <p>npm scripts</p>
<p><a href="https://jestjs.io/docs/cli">https://jestjs.io/docs/cli</a></p>
<p><code>backend/package.json</code></p>
<pre><code>&quot;scripts&quot;: {
  &quot;test&quot;: &quot;jest --verbose --coverage --runInBand&quot;,
  &quot;build&quot;: &quot;tsc&quot;,
  &quot;start&quot;: &quot;node out/index.js&quot;
}
</code></pre>

            </section>
        

    </section>
    



    
    <section>
        <section >
            <h3>Create test case</h3>

            </section>
        
            <section >
                <p>Create <code>src/tests/server.spec.ts</code></p>
<pre><code class="language-typescript=">import { FastifyInstance } from 'fastify'
import { startFastify } from '../server'

describe('Server test', () =&gt; {
    let server: FastifyInstance

    beforeAll(async () =&gt; {
        server = startFastify(8888)
        await server.ready()
    })
    
    afterAll(async () =&gt; {
        try {
            await server.close()
            console.log('Closing Fastify server is done!')
        } catch (e) {
            console.log(`Failed to close a Fastify server, reason: ${e}`)
        }
    })

    it('should successfully get a pong string', async () =&gt; {
        const response = await server.inject({ method: 'GET', url: '/ping' })

        expect(response.statusCode).toBe(200)
        expect(response.body).toStrictEqual(JSON.stringify({ msg: 'pong' }))
    })
})
</code></pre>

            </section>
        
            <section >
                <p>Not connect to dev database when runnning test case</p>
<p>update <code>backend/plugins/mongoose.ts</code></p>
<pre><code class="language-typescript=">import mongoose from 'mongoose'

const establishConnection = () =&gt; {
    // jest set the env var - JEST_WORKER_ID
    if (!process.env.JEST_WORKER_ID &amp;&amp; mongoose.connection.readyState === 0) {
        const connectionString = process.env.MONGO_CONNECTION_STRING || 'mongodb://localhost:27017/myProject'
        mongoose.connect(connectionString, error =&gt; {
            if (error) {
                console.log(`Error in DB connection: ${error}`)
            } else {
                console.log(`MongoDB connection successful`)
            }
        })
    }
}

export { establishConnection }
</code></pre>

            </section>
        
            <section >
                <h4>Run test</h4>
<pre><code>npm run test
</code></pre>

            </section>
        

    </section>
    



    
    <section>
        <section >
            <h4>describe &amp; it</h4>
<pre><code class="language-typescript">describe('Server test', () =&gt; {
    it('should successfully get a pong string', () =&gt; {
        // Some testing condition
    })
})
</code></pre>

            </section>
        
            <section >
                <pre><code class="language-typescript">describe('API test', () =&gt; {
    it('should successfully get a pong string', () =&gt; {
        // Some testing condition
    })
    it('test B', () =&gt; {})
    it('test C', () =&gt; {})
    it('test D', () =&gt; {})
})
</code></pre>

            </section>
        
            <section >
                <h4>expect</h4>
<pre><code class="language-typescript">expect(response.statusCode).toBe(200)
expect(response.body).toStrictEqual(JSON.stringify({ msg: 'pong' }))
</code></pre>
<ul>
<li>toBe() - to compare primitive values or to check referential identity of object instances</li>
<li>toStrictEqual() - to test that objects have the same types as well as structure</li>
</ul>

            </section>
        
            <section >
                <p><a href="https://jestjs.io/docs/expect">https://jestjs.io/docs/expect</a></p>
<pre><code class="language-typescript">expect(1 + 2).toBeLessThan(4)
expect(1 + 2).toBeLessThanOrEqual(3)
expect(['A', 'B', 'C']).toContain('B')  
expect(1 + 2).not.toBe(4)
</code></pre>

            </section>
        
            <section >
                <p>Synchronous</p>
<pre><code class="language-typescript">describe('Math test', () =&gt; {
    it('1 + 2 should be 3', () =&gt; {
        const a = 1
        const b = 2
        expect(a + b).toBe(3)
    })
})
</code></pre>

            </section>
        
            <section >
                <p>Asynchronous</p>
<pre><code class="language-typescript">// pong.ts
async getPong(): Promise&lt;string&gt; {
    return new Promise((resolve) =&gt; {
        resolve('pong')
    })
}

// pong.spec.ts
describe('asynchronous test', () =&gt; {
    it('get pong', async () =&gt; {
        const result = await pong.getPong()
        expect(result).toBe('pong')
    })
    it('still get pong', async () =&gt; {
        await expect(pong.getPong()).resolves.toBe('pong')
    })
})
</code></pre>

            </section>
        

    </section>
    



    
    <section>
        <section >
            <h3>Testing database</h3>
<p>mongodb-memory-server</p>

            </section>
        
            <section >
                <p>Install mongodb-memory-server</p>
<pre><code class="language-planetext">npm i -D mongodb-memory-server
</code></pre>
<p><a href="https://github.com/nodkz/mongodb-memory-server">https://github.com/nodkz/mongodb-memory-server</a></p>

            </section>
        
            <section >
                <p>Create <code>src/tests/db.ts</code></p>
<pre><code class="language-typescript=">import mongoose from 'mongoose'
import { MongoMemoryServer } from 'mongodb-memory-server'

const mongod = new MongoMemoryServer()

/**
 * Connect to mock memory db.
 */
export const connect = async () =&gt; {
    await mongod.start()
    const uri = mongod.getUri()
    await mongoose.connect(uri)
}

/**
 * Close db connection
 */
export const closeDatabase = async () =&gt; {
    await mongoose.connection.dropDatabase()
    await mongoose.connection.close()
    await mongod.stop()
}

/**
 * Delete db collections
 */
export const clearDatabase = async () =&gt; {
    const collections = mongoose.connection.collections
    for (const key in collections) {
        const collection = collections[key]
        await collection.deleteMany({})
    }
}
</code></pre>

            </section>
        
            <section >
                <h3>API Test</h3>
<p>(using mongodb-memory-server)</p>

            </section>
        
            <section >
                <p>create backend/tests/cat.spec.ts</p>
<pre><code class="language-typescript=">import { FastifyInstance } from 'fastify'
import { startFastify } from '../server'
import * as dbHandler from './db'
import { ICat } from '../types/cat'

describe('Cat API test', () =&gt; {
  let server: FastifyInstance
  const fastifyPort = 8888

  beforeAll(async () =&gt; {
    await dbHandler.connect()
    server = startFastify(fastifyPort)
    await server.ready()
  })

  afterEach(async () =&gt; {
    await dbHandler.clearDatabase()
  })

  afterAll(async () =&gt; {
    await dbHandler.closeDatabase()
    await server.close()
    console.log('Closing Fastify server is done!')
  })

  it('should successfully get a empty list of cats', async () =&gt; {
    const response = await server.inject({ method: 'GET', url: '/api/cats' })

    expect(response.statusCode).toBe(200)
    expect(response.body).toStrictEqual(JSON.stringify({ cats: [] }))
  })

  it('should successfully post a cat to mongodb', async () =&gt; {
    const response = await server.inject({
      method: 'POST',
      url: '/api/cats',
      payload: {
        name: 'fat cat',
        weight: 6.8
      }
    })

    expect(response.statusCode).toBe(201)
    const cat: ICat = JSON.parse(response.body)['cat']
    expect(cat.name).toBe('fat cat')
    expect(cat.weight).toBe(6.8)

  })

})
</code></pre>

            </section>
        

    </section>
    



    
    <section>
        <section >
            <h3>Testing database</h3>
<p>Testcontainers-mongoose</p>

            </section>
        
            <section >
                <p><a href="https://github.com/yubinTW/testcontainers-mongoose">https://github.com/yubinTW/testcontainers-mongoose</a></p>
<pre><code>npm i -D testcontainers-mongoose
</code></pre>

            </section>
        
            <section >
                <h3>API Test</h3>
<p>(using testcontainers-mongoose)</p>

            </section>
        
            <section >
                <p>create backend/tests/cat.spec.ts</p>
<pre><code class="language-typescript=">import { FastifyInstance } from 'fastify'
import { startFastify } from '../server'
import * as dbHandler from 'testcontainers-mongoose'
import { ICat } from '../types/cat'

describe('Cat API test', () =&gt; {
  let server: FastifyInstance
  const fastifyPort = 8888

  beforeAll(async () =&gt; {
    await dbHandler.connect('harbor.yourcompany.com/mongo:4.4.4')
    server = startFastify(fastifyPort)
    await server.ready()
  })

  afterEach(async () =&gt; {
    await dbHandler.clearDatabase()
  })

  afterAll(async () =&gt; {
    await dbHandler.closeDatabase()
    await server.close()
    console.log('Closing Fastify server is done!')
  })

  it('should successfully get a empty list of cats', async () =&gt; {
    const response = await server.inject({ method: 'GET', url: '/api/cats' })

    expect(response.statusCode).toBe(200)
    expect(response.body).toStrictEqual(JSON.stringify({ cats: [] }))
  })

  it('should successfully post a cat to mongodb', async () =&gt; {
    const response = await server.inject({
      method: 'POST',
      url: '/api/cats',
      payload: {
        name: 'fat cat',
        weight: 6.8
      }
    })

    expect(response.statusCode).toBe(201)
    const cat: ICat = JSON.parse(response.body)['cat']
    expect(cat.name).toBe('fat cat')
    expect(cat.weight).toBe(6.8)

  })

})
</code></pre>

            </section>
        
            <section >
                <p><a href="https://www.fastify.io/docs/latest/Guides/Testing/">https://www.fastify.io/docs/latest/Guides/Testing/</a></p>

            </section>
        

    </section>
    



    
    <section>
        <section >
            <h3>Deployment Strategy</h3>

            </section>
        
            <section >
                <p>MERN Arch.</p>
<ul>
<li>Frontend
<ul>
<li>React</li>
</ul>
</li>
<li>Backend
<ul>
<li>Fastify</li>
</ul>
</li>
<li>Database
<ul>
<li>MongoDB</li>
</ul>
</li>
</ul>
<p><img src="res/2021-08-21-22-52-16.png" alt=""></p>

            </section>
        
            <section >
                <p>React build static files</p>
<p><img src="res/2021-08-21-23-29-36.png" alt=""></p>

            </section>
        
            <section >
                <p>Who serve the static files ?</p>
<ul>
<li>Frontend Server ?</li>
<li>Backend Server ?</li>
</ul>

            </section>
        

    </section>
    



    
    <section>
        <section >
            <p>Frontend Server</p>
<p><img src="res/2021-08-21-23-35-41.png" alt=""></p>
<ul>
<li>CORS issue</li>
<li>User can visit website even when the backend server is down</li>
</ul>

            </section>
        
            <section >
                <p>CORS</p>
<p>ref: <a href="https://developer.mozilla.org/zh-TW/docs/Web/HTTP/CORS">https://developer.mozilla.org/zh-TW/docs/Web/HTTP/CORS</a></p>

            </section>
        
            <section >
                <p>Fastify-CORS</p>
<pre><code class="language-planttext">cd backend
npm i fastify-cors
</code></pre>
<p><a href="https://github.com/fastify/fastify-cors">https://github.com/fastify/fastify-cors</a></p>

            </section>
        
            <section >
                <p>register in backend/src/server.ts</p>
<pre><code class="language-typescript=">import fastifyCors from 'fastify-cors'
// ...
server.register(fastifyCors, {})
</code></pre>

            </section>
        

    </section>
    



    
    <section>
        <section >
            <p>Backend Server</p>
<p><img src="res/2021-08-21-23-40-07.png" alt=""></p>

            </section>
        
            <section >
                <p>Fastify-Static plugin</p>
<pre><code class="language-planttext">cd backend
npm i fastify-static
</code></pre>
<p><a href="https://github.com/fastify/fastify-static">https://github.com/fastify/fastify-static</a></p>

            </section>
        
            <section >
                <p>register in backend/src/server.ts</p>
<pre><code class="language-typescript=">import fastifyStatic from 'fastify-static'
import path from 'path'
// ...
server.register(fastifyStatic, {
  root: path.join(__dirname, '../../frontend/build'),
  prefix: '/'
})
</code></pre>

            </section>
        
            <section >
                <p>build frontend code</p>
<pre><code class="language-planttext">cd frontend
npm run build
</code></pre>
<p>start backend server</p>
<pre><code class="language-planttext">cd backend
npm run build
npm run start
</code></pre>

            </section>
        

    </section>
    



    
        <section >
            
            <p>end</p>

            </section>
    


    </div>


  </div>

  	
	<script src="libs/reveal.js/4.1.3/reveal.js"></script>
	<script src="libs/reveal.js/4.1.3/plugin/zoom/zoom.js"></script>
	<script src="libs/reveal.js/4.1.3/plugin/notes/notes.js"></script>
	<script src="libs/reveal.js/4.1.3/plugin/search/search.js"></script>
	<script src="libs/reveal.js/4.1.3/plugin/markdown/markdown.js"></script>
	<script src="libs/reveal.js/4.1.3/plugin/highlight/highlight.js"></script>
	<script src="libs/reveal.js/4.1.3/plugin/menu/menu.js"></script>
	<script src="libs/reveal.js/4.1.3/plugin/math/math.js"></script>

	<script src="libs/reveal.js/4.1.3/plugin/fullscreen/plugin.js"></script>
  
  	<script src="libs/reveal.js/4.1.3/plugin/animate/plugin.js"></script>
  	<script src="libs/reveal.js/4.1.3/plugin/animate/svg.min.js"></script>
  
  	<script src="libs/reveal.js/4.1.3/plugin/anything/plugin.js"></script>
	  <script src="libs/reveal.js/4.1.3/plugin/anything/Chart.min.js"></script>
	<script src="libs/reveal.js/4.1.3/plugin/anything/d3/d3.v3.min.js"></script>				
	<script src="libs/reveal.js/4.1.3/plugin/anything/d3.patch.js"></script>			
	<script src="libs/reveal.js/4.1.3/plugin/anything/d3/queue.v1.min.js"></script>		
	<script src="libs/reveal.js/4.1.3/plugin/anything/d3/topojson.v1.min.js"></script>		
	<script src="libs/reveal.js/4.1.3/plugin/anything/function-plot.js"></script>

 <!--	<script src="libs/reveal.js/4.1.3/plugin/audio-slideshow/plugin.js"></script>  -->
<!--	<script src="libs/reveal.js/4.1.3/plugin/audio-slideshow/recorder.js"></script>-->
<!--	<script src="libs/reveal.js/4.1.3/plugin/audio-slideshow/RecordRTC.js"></script>-->

<script src="libs/reveal.js/4.1.3/plugin/chalkboard/plugin.js"></script>
	<script src="libs/reveal.js/4.1.3/plugin/customcontrols/plugin.js"></script>
	<script src="libs/reveal.js/4.1.3/plugin/embed-tweet/plugin.js"></script>

	<script src="libs/reveal.js/4.1.3/plugin/chart/chart.min.js"></script>
	<script src="libs/reveal.js/4.1.3/plugin/chart/plugin.js"></script>

  <script>

		const printPlugins = [
			RevealNotes, 
			RevealHighlight,
			RevealMath,
			RevealAnimate,
			RevealChalkboard, 
			RevealEmbedTweet,
			RevealChart,
		];

		const plugins =  [...printPlugins,
		RevealZoom, 
		RevealSearch, 
				RevealMarkdown, 
				RevealMenu, 
				RevealFullscreen,
				RevealAnything,
				//RevealAudioSlideshow,
				//RevealAudioRecorder,
				RevealCustomControls, 
				// poll
				// question
				// seminar
				 ]


		// Also available as an ES module, see:
		// https://revealjs.com/initialization/
		Reveal.initialize({
			controls: true,
			controlsTutorial: true,
			controlsLayout: 'bottom-right',
			controlsBackArrows: 'faded',
			progress: true,
			slideNumber: true,
			//#showSlideNumber "all" "print" "speaker"
			hash: true,//#  hash: false,
			//# respondToHashChanges: true,
			//# history: false,
			keyboard: true,
			//#keyboardCondition: null,
			overview: true,
			center: true,
			touch: true,
			loop: false,
			rtl: false,
			//#navigationMode: 'default', linear grid
			shuffle: false,
			fragments: true,
			fragmentInURL: false,
			embedded: false,
			help: true,
			//#pause: true
			showNotes: false,
			autoPlayMedia: false, // TODO fix this to a nullable value
			//#preloadIframes: null. true false
			//#autoAnimate: true
			//#autoAnimateMatcher: null,
			//#autoAnimateEasing: 'ease',
			//autoAnimateDuration: 1.0,
			//#autoAnimateUnmatched: true
			//#autoAnimateStyles: []
			autoSlide: 0, // TODO fix this to a falseable value
			autoSlideStoppable: true,
			autoSlideMethod: '0',
			defaultTiming: 120,
			mouseWheel: false,
			//#previewLinks: false
			//#postMessage: true,  // TODO : this can cause issues with the vscode api ???
			//#postMessageEvents: false,
			//#focusBodyOnPageVisibilityChange: true,
			transition: 'slide',
			transitionSpeed: 'default',
			backgroundTransition: 'fade',
			//#pdfMaxPagesPerSlide: Number.POSITIVE_INFINITY,
			//#pdfSeparateFragments: true,
			//#pdfPageHeightOffset: -1,
			viewDistance: 3,
			//#mobileViewDistance: 2,
			display: 'block',
			//#hideInactiveCursor: true,
			//#hideCursorTime: 5000

			// Parallax Background
			parallaxBackgroundImage: '',
			parallaxBackgroundSize: '',
			parallaxBackgroundHorizontal: 0,
			parallaxBackgroundVertical: 0,
			
			//Presentation Size
			width: 960,
			height: 700,
			margin: 0.04,
			minScale: 0.2,
			maxScale: 2,
			disableLayout: false,

			audio: {
				prefix: 'audio/', 	// audio files are stored in the "audio" folder
				suffix: '.ogg',		// audio files have the ".ogg" ending
				textToSpeechURL: null,  // the URL to the text to speech converter
				defaultNotes: false, 	// use slide notes as default for the text to speech converter
				defaultText: false, 	// use slide text as default for the text to speech converter
				advance: 0, 		// advance to next slide after given time in milliseconds after audio has played, use negative value to not advance
				autoplay: false,	// automatically start slideshow
				defaultDuration: 5,	// default duration in seconds if no audio is available
				defaultAudios: true,	// try to play audios with names such as audio/1.2.ogg
				playerOpacity: 0.05,	// opacity value of audio player if unfocused
				playerStyle: 'position: fixed; bottom: 4px; left: 25%; width: 50%; height:75px; z-index: 33;', // style used for container of audio controls
				startAtFragment: false, // when moving to a slide, start at the current fragment or at the start of the slide
			},
			
			chalkboard: { // font-awesome.min.css must be available
					//src: "chalkboard/chalkboard.json",
					storage: "chalkboard-demo",
				},
			
			customcontrols: {
					controls: [
      						{
						  id: 'toggle-overview',
						  title: 'Toggle overview (O)',
						  icon: '<i class="fa fa-th"></i>',
						  action: 'Reveal.toggleOverview();'
						}
						,
						{ icon: '<i class="fa fa-pen-square"></i>',
						  title: 'Toggle chalkboard (B)',
						  action: 'RevealChalkboard.toggleChalkboard();'
						},
						{ icon: '<i class="fa fa-pen"></i>',
						  title: 'Toggle notes canvas (C)',
						  action: 'RevealChalkboard.toggleNotesCanvas();'
						}
				]
			},
			chart: {
					defaults: { 
						color: 'lightgray', // color of labels
						scale: { 
							beginAtZero: true, 
							ticks: { stepSize: 1 },
							grid: { color: "lightgray" } , // color of grid lines
						},
					},
					line: { borderColor: [ "rgba(20,220,220,.8)" , "rgba(220,120,120,.8)", "rgba(20,120,220,.8)" ], "borderDash": [ [5,10], [0,0] ] }, 
					bar: { backgroundColor: [ "rgba(20,220,220,.8)" , "rgba(220,120,120,.8)", "rgba(20,120,220,.8)" ]}, 
					pie: { backgroundColor: [ ["rgba(0,0,0,.8)" , "rgba(220,20,20,.8)", "rgba(20,220,20,.8)", "rgba(220,220,20,.8)", "rgba(20,20,220,.8)"] ]},
					radar: { borderColor: [ "rgba(20,220,220,.8)" , "rgba(220,120,120,.8)", "rgba(20,120,220,.8)" ]}, 
			},
			math: {
				mathjax: 'https://cdn.jsdelivr.net/gh/mathjax/mathjax@2.7.8/MathJax.js',
				config: 'TeX-AMS_HTML-full',
				// pass other options into `MathJax.Hub.Config()`
				TeX: { Macros: { RR: "{\\bf R}" } }
				},
				anything: [ 
				{
		className: "plot",
		defaults: {width:500, height: 500, grid:true},
		initialize: (function(container, options){ options.target = "#"+container.id; functionPlot(options) })
	 },
	 {
		className: "chart",  
		initialize: (function(container, options){ container.chart = new Chart(container.getContext("2d"), options);  })
	 },
	 {
		className: "anything",
		initialize: (function(container, options){ if (options && options.initialize) { options.initialize(container)} })
	 },
					],
			// Learn about plugins: https://revealjs.com/plugins/
			plugins: (window.location.search.match(/print-pdf/gi) ? printPlugins : plugins ) 
		});
			


	    // Change chalkboard theme : 
		function changeTheme(input) {
			var config = {};
			config.theme = input.value;
			Reveal.getPlugin("RevealChalkboard").configure(config);
			input.blur();
		}

		// // Handle the message inside the webview
        // window.addEventListener('message', event => {

        //     const message = event.data; // The JSON data our extension sent

        //     switch (message.command) {
        //         case 'refactor':
        //             Reveal.toggleHelp();
        //     }
        // });

		if (window.location.search.match(/print-pdf-now/gi)) {
      		setTimeout(() => {
				window.print();
			  }, 2500);
			
    }
		

	</script>

</body>

</html>